<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/theme-soft-light.v1.css">
  <link rel="stylesheet" href="css/nav-ribbon.v5.css">

  <script>
  window.IDMAR_VERSION="Vs 1.3";
  window.IDMAR_HIDE_NAV = true;   // esconde os links no header do login
  window.IDMAR_FOOTER_TEXT = "IDMAR ¬∑ Identifica√ß√£o Mar√≠tima ‚Äî Cascos & Motores";
</script>
<script defer src="js/idmar-config.v4.js"></script>

  <!-- üîê Gate de sess√£o (NOVA LINHA) -->
<script defer src="js/session-gate.js"></script>

<script defer src="js/idmar-i18n.js"></script>
<script defer src="js/idmar-header-only.all.v4.js"></script>

<style>
    :root{--bg:#f8fafc;--fg:#0f172a;--bg-elev:#ffffff;--border:#e5e7eb;--link:#0b6bcb}
    html,body{height:100%}
    body{
      background:var(--bg); color:var(--fg); margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;
      display:flex; flex-direction:column;
    }
    main{flex:1; display:grid; place-items:center; padding:2rem}
    .card{
      width:min(480px, 94vw);
      background:var(--bg-elev);
      border:1px solid var(--border);
      border-radius:14px;
      padding:1.25rem 1.25rem 1rem;
      box-shadow:0 2px 10px rgba(0,0,0,.03);
    }
    h1{margin:.25rem 0 .5rem 0}
    .small{opacity:.8; margin:0 0 1rem 0}
    label{display:block; margin:.6rem 0 .25rem}
    input[type="text"],input[type="password"]{
      width:100%; border:1px solid var(--border); background:#fff;
      border-radius:10px; padding:.6rem .7rem; font-size:1rem;
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:.75rem; margin-top:.75rem}
    .left{display:flex; align-items:center; gap:.45rem}
    button{
      background:#0b6bcb; color:#fff; border:none; border-radius:10px;
      padding:.6rem 1rem; cursor:pointer; font-weight:600;
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    footer{border-top:1px solid var(--border); padding:1rem; text-align:left; opacity:.85; background:var(--bg-elev)}
  </style>

<script defer src="js/header-override.v4.js"></script>
<script defer src="js/i18n-boot.js"></script>
<script defer src="js/idmar-version.v5.js"></script>
</head>
 
<body>
  <main>
    <section class="card">
      <h1 data-i18n="login.title">Entrar</h1>
      <p class="small" data-i18n="login.lead">Aceda com as suas credenciais.</p>

      <label for="user" data-i18n="login.user_label">Utilizador</label>
      <input id="user" type="text" autocomplete="username" data-i18n-placeholder="login.user_ph" placeholder="nome.apelido"/>

      <label for="pass" data-i18n="login.pass_label">Palavra-passe</label>
      <input id="pass" type="password" autocomplete="current-password" data-i18n-placeholder="login.pass_ph" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>

      <div class="row">
        <label class="left">
          <input type="checkbox" id="remember"/>
          <span data-i18n="login.remember">Lembrar sess√£o</span>
        </label>
        <a href="#" data-i18n="login.forgot">Esqueci-me da palavra-passe</a>
      </div>

      <div class="row" style="margin-top:1rem">
        <div></div>
        <button id="btnLogin" data-i18n="login.signin">Iniciar sess√£o</button>
      </div>
    </section>
  </main>

  <footer>
    <div class="small">IDMAR ¬∑ <span data-i18n="app.subtitle">Identifica√ß√£o Mar√≠tima ‚Äî Cascos & Motores</span></div>
  </footer>

  <!-- Handler de login (corrigido) -->
<script>
  (function () {
    const KEY = 'IDMAR_SESSION';

    // (opcional) se j√° estiver logado, salta o login
    try {
      if (localStorage.getItem(KEY)) {
        // j√° tens sess√£o -> vai direto ao validador
        location.replace('validador.html');
        return;
      }
    } catch (e) {}

    function setSession(user, remember) {
      const sess = { user, role: 'operator', ts: Date.now() };
      // O GATE l√™ sempre do localStorage -> garantir aqui
      try { localStorage.setItem(KEY, JSON.stringify(sess)); } catch (e) {}
      // Se N√ÉO marcar "Lembrar sess√£o", tamb√©m espelha em sessionStorage (sai ao fechar o browser)
      if (!remember) {
        try { sessionStorage.setItem(KEY, JSON.stringify(sess)); } catch (e) {}
      }
    }

    function valueOf(id) {
      return (document.getElementById(id)?.value || '').trim();
    }

    function login() {
      const u = valueOf('user');
      const p = valueOf('pass');
      const remember = !!document.getElementById('remember')?.checked;

      // Credenciais demo
      if (u.toLowerCase() === 'admin' && p === 'Admin2025') {
        setSession(u, remember);
        location.href = 'validador.html';
      } else {
        alert('Credenciais inv√°lidas');
      }
    }

    document.getElementById('btnLogin')?.addEventListener('click', function (e) {
      e.preventDefault();
      login();
    });

    document.getElementById('pass')?.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        login();
      }
    });
  })();
</script>
</body>
</html>
