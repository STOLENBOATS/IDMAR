<!doctype html>
<html lang="pt">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IDMAR — Validador</title>
  <link rel="icon" href="img/logo-pm.png" />

  <!-- CSS base -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/theme-soft-light.v1.css"><!-- tema claro -->
  <link rel="stylesheet" href="css/nav-ribbon.v5.css"><!-- botões "ribbon" v5 -->

   <style>
    :root{--bg:#f8fafc;--fg:#0f172a;--bg-elev:#ffffff;--border:#e5e7eb;--link:#0b6bcb}
    html,body{height:100%}
    body{background:var(--bg);color:var(--fg);margin:0;display:flex;flex-direction:column;
         font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif}
    main{flex:1}
    .container{max-width:1100px;margin:1.25rem auto;padding:0 1rem}
    .panel{background:var(--bg-elev);border:1px solid var(--border);border-radius:12px;padding:1rem;margin:.75rem 0}
    .two{display:grid;grid-template-columns:1fr;gap:1rem}
    @media(min-width:980px){ .two{grid-template-columns:1fr 1fr} }
    label{display:block;margin:.35rem 0 .25rem}
    input[type="text"], input[type="search"], input[type="file"], select, textarea{
      width:100%;border:1px solid var(--border);background:#fff;border-radius:10px;padding:.5rem .6rem;
    }
    button{background:#0b6bcb;color:#fff;border:none;border-radius:10px;padding:.55rem .9rem;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:.5rem}
    th,td{border-bottom:1px solid var(--border);padding:.6rem .5rem;text-align:left}
    .small{opacity:.75;font-size:.9em}
    .badge{display:inline-block;border-radius:999px;padding:.15rem .55rem;font-weight:600}
    .good{background:#10b98120;color:#065f46}
    .bad{background:#ef444420;color:#7f1d1d}
    details.forense-box{margin-top:.75rem;border:1px dashed var(--border);border-radius:10px;padding:.5rem}
    .forense-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.5rem;margin-top:.5rem}
    .footer{border-top:1px solid var(--border);padding:1rem;text-align:left;opacity:.85;background:var(--bg-elev)}
  </style>
  
  <!-- Gate de sessão simples -->
  <script>
    (function(){
      try{
        var ok = sessionStorage.getItem('IDMAR_SESSION')==='ok' || sessionStorage.getItem('NAV_SESSION')==='ok';
        if(!ok) location.replace('login.html');
      }catch(e){}
    })();
  </script>

  <!-- Versão + branding -->
  <script>window.IDMAR_VERSION="Vs 1.3";</script>
  <script defer src="js/idmar-config.v4.js"></script>

  <!-- Core: i18n + header -->
  <script defer src="js/idmar-i18n.js"></script>
  <script defer src="js/idmar-header-only.all.v4.js"></script>

  <!-- Overrides (aplicam labels, ribbons e rodapé) -->
  <script defer src="js/header-override.v4.js"></script>
  <script defer src="js/i18n-boot.js"></script>
  <script defer src="js/idmar-version.v4.js"></script>
</head>

<body>
  <!-- header é injetado por JS -->

  <main class="container">
    <h1>Validador</h1>

    <section class="two">
      <!-- WIN -->
      <div class="panel">
        <h2>Validador WIN</h2>
        <form id="formWin">
          <label for="win">WIN / HIN</label>
          <input id="win" type="text" placeholder="Ex.: PT-ABC12345D404"/>
          <div style="margin:.5rem 0">
            <button id="btnWin" type="submit">Validar WIN</button>
          </div>

          <div style="margin-top:.5rem">
            <label for="winPhoto">Foto opcional / Optional photo</label>
            <input id="winPhoto" type="file" accept="image/*"/>
          </div>

          <div id="winOut" style="margin-top:.75rem"></div>

          <table>
            <thead>
              <tr><th>Campo / Field</th><th>Valor / Value</th><th>Interpretação / Meaning</th></tr>
            </thead>
            <tbody id="interpWinBody"></tbody>
          </table>
        </form>
      </div>

      <!-- MOTOR -->
      <div class="panel">
        <h2>Validador Motor</h2>
        <form id="formMotor">
          <label for="brand">Marca</label>
          <!-- marca -->
          <select id="brand" data-engine-field="brand">
            <option>Yamaha</option><option>Honda</option><option>Suzuki</option><option>Tohatsu</option>
            <option>Mercury</option><option>MerCruiser</option><option>Volvo Penta</option>
            <option>Yanmar</option><option>Evinrude/Johnson</option>
          </select>

          <!-- aqui o JS pode injetar campos dinâmicos (shaft / par de letras / série, etc.) -->
          <div id="brandDynamic"></div>

          <div style="margin-top:.5rem;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.5rem">
            <div>
              <label>Modelo (pesquisa)</label>
              <input id="srch_model" type="text" placeholder="Ex.: DF140A"
                     data-engine-field="model_code"/>
            </div>
            <div>
              <label>Potência (hp)</label>
              <input id="srch_power" type="text" placeholder="Ex.: 150"
                     data-engine-field="power"/>
            </div>
            <div>
              <label>Cilindrada (cc)</label>
              <input id="srch_disp" type="text" placeholder="Ex.: 2670"
                     data-engine-field="displacement"/>
            </div>
            <div>
              <label>Ano</label>
              <input id="srch_year" type="text" placeholder="Ex.: 2017"
                     data-engine-field="year"/>
            </div>
            <div>
              <label>Origem</label>
              <input id="srch_origin" type="text" placeholder="Ex.: Japão"
                     data-engine-field="origin"/>
            </div>
          </div>

          <div style="margin:.5rem 0">
            <button id="btnMotor" type="submit">Validar Motor</button>
          </div>

          <div style="margin-top:.5rem">
            <label for="motorPhoto">Foto opcional / Optional photo</label>
            <input id="motorPhoto" type="file" accept="image/*"/>
          </div>

          <div id="motorOut" style="margin-top:.75rem"></div>
        </form>
      </div>
    </section>
  </main>

  <footer class="footer" id="fallback-footer">IDMAR — Identificação Marítima</footer>

  <!-- Removido idmar-layout.r3b.js para não duplicar header -->
  <script src="js/validador-win.r3b.js?v=r3b"></script>
  <script src="js/validador-motor.r3d.js?v=r3d"></script>
  <script defer src="js/validator-enhancements.v4.js"></script>

  <!-- CONFIGURADOR (schema v2) -->
  <script type="module"
    src="js/engine_picker.v2.4.js"
    data-catalog="data/engines_catalog.v2.json"></script>

  <!-- Validador de combinações (usa o mesmo catálogo v2) -->
  <script defer src="js/engine_validation.v1.js"></script>

  <!-- Admin rápido embutido (motores + WIN) – se NÃO quiseres este bloco na página, comenta esta linha -->
  <!-- <script defer src="js/engine_admin_embed.v1.js"></script>

  <!-- Botão "Admin" no ribbon -->
  <script>window.IDMAR_ADMIN_URL = 'admin-engines.html';</script>
  <script defer src="js/ribbon-admin.v1.js"></script>

  <!-- AUTOCOMPLETE ANTIGO (schema v1) -->
  <script type="module"
    src="js/engine_autocomplete_addon.v1.js"
    data-catalog="data/engines_catalog.v1.json"></script>
<script defer src="js/cards-layout-fix2.js"></script>

<!-- IDMAR patch: Cartão 3 ao lado do Cartão 2 (runtime, blindado) -->
<script>
(function(d){
  function style(){var s=d.createElement('style');
    s.textContent='.cards-row{display:grid!important;grid-template-columns:1fr 1fr!important;gap:1rem!important;align-items:start!important}'
                 +'.cards-row>.card{width:auto!important;max-width:100%!important;margin:0!important}'
                 +'@media(max-width:1024px){.cards-row{grid-template-columns:1fr!important}}';
    d.head.appendChild(s);}
  function buildCard(){
    var t=d.createElement('template');
    t.innerHTML =
    '<section id="card-motor-quick" class="card" style="background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:1rem;box-shadow:0 1px 2px rgba(0,0,0,.04)">'+
      '<h2 style="margin:.25rem 0">Nº de Motor - Pesquisa / Engine No. - Search</h2>'+
      '<div style="display:grid;gap:.5rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))">'+
        '<label><b>Marca / Brand</b><input id="mq-brand" placeholder="Yamaha, Honda, Mercury..."></label>'+
        '<label><b>Modelo / Model</b><input id="mq-model" placeholder="F350, BF150, DF90..."></label>'+
        '<label><b>Variante / Variant</b><input id="mq-variant" placeholder="NSA, A, X, L..."></label>'+
        '<label><b>Nº Série / Serial</b><input id="mq-serial" placeholder="6ML-1005843 / BAAL-1234567"></label>'+
      '</div>'+
      '<div style="margin-top:.75rem;display:flex;gap:.5rem;flex-wrap:wrap">'+
        '<button id="mq-validate" class="btn" style="padding:.6rem 1rem;border:1px solid #0b6bcb;border-radius:10px;background:#0b6bcb;color:#fff;cursor:pointer">Validar nº de motor / Validate</button>'+
        '<a class="btn secondary" href="validador_motor_simplificado.html" style="padding:.6rem 1rem;border:1px solid #0b6bcb;border-radius:10px;background:#fff;color:#0b6bcb;cursor:pointer;text-decoration:none">Abrir página avançada / Open advanced</a>'+
      '</div>'+
      '<div id="mq-feedback" class="muted" style="margin-top:.5rem;opacity:.8"></div>'+
    '</section>';
    return t.content.firstElementChild;
  }
  function attachLogic(){
    var b=d.getElementById('mq-validate'); if(!b) return;
    if(b.dataset.bound) return; b.dataset.bound="1";
    b.addEventListener('click', function(){
      var v=function(x){return (x||'').trim();};
      var rec={
        date:new Date().toISOString(),
        brand:v(d.getElementById('mq-brand')?.value),
        model:v(d.getElementById('mq-model')?.value),
        variant:v(d.getElementById('mq-variant')?.value),
        motor:v(d.getElementById('mq-serial')?.value),
        result:'Registado / Recorded',
        reason:'Cartão 3',
        photo:''
      };
      try{var a=JSON.parse(localStorage.getItem('hist_motor')||'[]'); a.unshift(rec); localStorage.setItem('hist_motor', JSON.stringify(a));}catch(e){}
      var fb=d.getElementById('mq-feedback'); if(fb){ fb.textContent='Registado: '+[rec.brand,rec.model,rec.variant,rec.motor].filter(Boolean).join(' / '); }
    });
  }
  function place(){
    style();
    var c3=d.getElementById('card-motor-quick') || buildCard();
    var cards=Array.from(d.querySelectorAll('main .card'));
    var c2=cards[1]; if(!c2){ // fallback: mete no fim do <main>
      (d.querySelector('main')||d.body).appendChild(c3); attachLogic(); return;
    }
    var wrap=d.createElement('div'); wrap.className='cards-row';
    // inserir antes do cartão 2
    (c2.closest('.card')||c2).parentNode.insertBefore(wrap,(c2.closest('.card')||c2));
    wrap.appendChild(c2.closest('.card')||c2);
    wrap.appendChild(c3.closest('.card')||c3);
    // neutralizar wrappers col-12, etc.
    [wrap.firstElementChild, wrap.lastElementChild].forEach(function(el){
      if(el && el.parentElement===wrap) { el.style.width='auto'; el.style.maxWidth='100%'; el.style.margin='0'; }
    });
    attachLogic();
  }
  if(d.readyState!=='loading') place(); else d.addEventListener('DOMContentLoaded', place);
})(document);
</script>


  
</body>
</html>

