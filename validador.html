<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IDMAR — Validador</title>
  <link rel="icon" href="img/logo-pm.png" />
  <link rel="apple-touch-icon" href="img/logo-pm.png" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0b6bcb">

  <!-- CSS base -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/theme-soft-light.v1.css">
  <link rel="stylesheet" href="css/nav-ribbon.v5.css">

  <style>
    :root{--bg:#f8fafc;--fg:#0f172a;--bg-elev:#ffffff;--border:#e5e7eb;--link:#0b6bcb}
    html,body{height:100%}
    body{background:var(--bg);color:var(--fg);margin:0;display:flex;flex-direction:column;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
    header.app-header{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;border-bottom:1px solid var(--border);background:#fff}
    header .brand{display:flex;align-items:center;gap:.75rem}
    header .brand img{width:34px;height:34px;object-fit:contain;opacity:.9}
    header .brand .titles h1{font-size:1.125rem;margin:.1rem 0}
    header .brand .titles .subtitle{font-size:.8rem;margin:0;opacity:.75}
    .container{max-width:1100px;margin:0 auto;padding:1rem;flex:1;width:100%}
    .ribbon{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0 1rem 0}
    .ribbon button{border:1px solid var(--border);background:#fff;padding:.5rem .75rem;border-radius:.65rem;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--bg-elev);border:1px solid var(--border);border-radius:.75rem;padding:1rem}
    .field{display:flex;flex-direction:column;gap:.25rem;margin-bottom:.65rem}
    label{font-weight:600}
    input,select,textarea{padding:.55rem .6rem;border:1px solid var(--border);border-radius:.55rem}
    .result{border:1px dashed var(--border);padding:.75rem;border-radius:.65rem;background:#fafafa}
    footer{border-top:1px solid var(--border);padding:.75rem 1rem;font-size:.85rem;opacity:.8;background:#fff}
    .lang{margin-left:auto; display:flex; gap:.5rem; align-items:center}
    .logout-btn{border:1px solid var(--border);background:#fff;padding:.45rem .6rem;border-radius:.55rem;cursor:pointer}
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img src="img/logo-pm.png" alt="Polícia Marítima" />
      <div class="titles">
        <h1>IDMAR</h1>
        <p class="subtitle">Identificação Marítima • Cascos &amp; Motores</p>
      </div>
    </div>
    <div class="lang">
      <select id="langSelect" aria-label="Idioma">
        <option value="pt">PT</option>
        <option value="en">EN</option>
      </select>
      <button class="logout-btn" id="btnLogout" title="Sair">Sair</button>
    </div>
  </header>

  <div class="container">
    <div class="ribbon" id="navRibbon">
      <button data-target="#sec-win" class="rb">WIN / HIN</button>
      <button data-target="#sec-motor" class="rb">Motor</button>
      <button data-target="#sec-hist" class="rb">Histórico</button>
    </div>

    <section id="sec-win" class="card">
      <h2 data-i18n="win.title">Validação de WIN / HIN</h2>
      <div class="grid">
        <div>
          <div class="field">
            <label for="winInput" data-i18n="win.input">Número WIN/HIN</label>
            <input id="winInput" placeholder="ex.: PT-ABC12345L9 99" />
          </div>
          <div class="field">
            <label for="winNotes" data-i18n="win.notes">Notas / Observações</label>
            <textarea id="winNotes" rows="3"></textarea>
          </div>
          <button id="btnValidateWIN" data-i18n="win.btn">Validar</button>
          <button id="btnSaveWIN" data-i18n="win.save">Guardar no histórico</button>
        </div>
        <div>
          <div class="result" id="winResult" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <section id="sec-motor" class="card" hidden>
      <h2 data-i18n="motor.title">Validação de Motor</h2>
      <div class="grid">
        <div>
          <div class="field">
            <label for="brandSelect" data-i18n="motor.brand">Marca</label>
            <select id="brandSelect">
              <option value="yamaha">Yamaha</option>
              <option value="honda">Honda</option>
            </select>
          </div>

          <!-- Bridge: selects de modelo/variante visíveis (fora de #legacy-brand-model) -->
          <div class="field">
            <label for="modelBaseList">Modelo base</label>
            <select id="modelBaseList"></select>
          </div>
          <div class="field">
            <label for="modelVariantList">Variante</label>
            <select id="modelVariantList"></select>
          </div>

          <!-- Campos adaptativos por marca -->
          <div id="brandFields"></div>

          <div class="field">
            <label for="motorNotes" data-i18n="motor.notes">Notas / Observações</label>
            <textarea id="motorNotes" rows="3"></textarea>
          </div>
          <button id="btnValidateMotor" data-i18n="motor.btn">Validar</button>
          <button id="btnSaveMotor" data-i18n="motor.save">Guardar no histórico</button>
        </div>
        <div>
          <div class="result" id="motorResult" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <section id="sec-hist" class="card" hidden>
      <h2 data-i18n="hist.title">Histórico</h2>
      <div class="grid">
        <div>
          <button id="btnLoadHistWIN">Listar WIN</button>
          <button id="btnLoadHistMotor">Listar Motores</button>
        </div>
        <div>
          <div class="result" id="histResult"></div>
        </div>
      </div>
    </section>
  </div>

  <footer>
    IDMAR • Validador — <span id="verStr">v4.2.1-auth-min — 2025-10-15</span>
  </footer>

  <script defer src="js/config.js"></script>
  <script defer src="js/session-gate.js"></script>
  <script defer src="js/i18n.js"></script>
  <script defer src="js/nav.js"></script>
  <script defer src="js/history-service.js"></script>
  <script defer src="js/validador-win.js"></script>
  <script defer src="js/validador-motor.js"></script>
  <script defer src="js/model-split-bridge.v1.js"></script>
  <script defer src="js/pwa-register.js"></script>
  <script>
    document.getElementById('btnLogout')?.addEventListener('click', () => {
      if (window.IDMAR && window.IDMAR.logout) window.IDMAR.logout();
    });
  </script>
</body>
</html>
